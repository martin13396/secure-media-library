# Secure Media Library

A self-hosted, encrypted media management platform with military-grade security, designed for private home networks with VPN-only access. Stream your photos and videos securely from anywhere while maintaining complete control over your data.

## üéØ Overview

The Secure Media Library transforms your Mac Mini into a private media streaming server, accessible only through VPN. It automatically processes, encrypts, and serves your media files with enterprise-level security while providing a modern, responsive web interface.

### Key Features

- üîê **VPN-Only Access**: Complete network isolation with mandatory OpenVPN authentication
- üõ°Ô∏è **Military-Grade Encryption**: AES-128-CBC encryption for all media files
- üìπ **HLS Video Streaming**: Encrypted adaptive bitrate streaming with multiple quality levels
- üé¨ **Smart Thumbnails**: Auto-generated animated WebP previews for instant video recognition
- üë• **Multi-Device Support**: Manage sessions across devices with secure authentication
- ü§ñ **Automated Processing**: Drop files in, get encrypted media out - fully automated
- üì± **Responsive Design**: Works seamlessly on desktop, tablet, and mobile devices

## üìã Prerequisites

### Hardware Requirements
- Mac Mini with macOS 12.0+ (Monterey or later) - Intel or Apple Silicon
- 8GB RAM minimum (16GB recommended for smooth video processing)
- 50GB+ free disk space for Docker and media storage
- Stable network connection

### Software Requirements
- Docker Desktop for Mac 4.20+ ([Download](https://www.docker.com/products/docker-desktop/))
- Git for cloning the repository
- Terminal access with sudo privileges

### Network Requirements
- Router with OpenVPN server capability (ASUS, DD-WRT, OpenWRT, etc.)
- Static IP or DDNS for remote access
- Port UDP forwarded for VPN access
- Local network access to port 1027

## üöÄ Installation Guide

### Step 1: Clone the Repository

```bash
git clone https://github.com/your-username/secure-media-library.git
cd secure-media-library
```

### Step 2: Configure Docker Desktop

1. Open Docker Desktop
2. Go to **Settings** ‚Üí **Resources**
3. Configure:
   - **CPUs**: 4+ cores
   - **Memory**: 6GB minimum
   - **Disk image size**: 50GB+
4. Enable **"Use virtualization framework"** for better performance
5. Apply & Restart

### Step 3: Run the Setup Script

```bash
chmod +x scripts/*.sh
./scripts/setup.sh
```

This script will:
- Generate SSL certificates for HTTPS
- Create encryption keys for media files
- Set up the `.env` file with secure random passwords
- Create necessary directories with proper permissions
- Build Docker images
- Initialize the database

### Step 4: Configure Your Router's VPN

1. Access your router's admin panel (typically `192.168.1.1`)
2. Enable OpenVPN server with these settings:
   ```
   Port: 1100
   Protocol: UDP
   VPN Subnet: 10.0.0.0/24
   Encryption: AES-128-CBC
   ```
3. Export the `.ovpn` client configuration file
4. Configure port forwarding if needed

### Step 5: Start the Application

```bash
docker-compose up -d
```

Wait for all services to start (typically 30-60 seconds):
```bash
docker-compose ps  # All services should show "Up"
```

### Step 6: Initial Login

1. Open your browser to `https://localhost:1027` (local) or `https://[YOUR-IP]:1027` (VPN)
2. Accept the self-signed certificate warning
3. Login with default credentials:
   - **Username**: `admin`
   - **Password**: `password`
4. **Important**: Change the admin password immediately

## üîß Configuration

### Environment Variables

The `.env` file contains all configuration options. Key settings include:

```bash
# Network Configuration
PUBLIC_BASE_URL=https://localhost:1027
ALLOWED_NETWORKS=127.0.0.1,192.168.1.0/24,10.8.0.0/24

# Security Settings
JWT_ACCESS_TOKEN_EXPIRY=15m
JWT_REFRESH_TOKEN_EXPIRY=7d
SESSION_TIMEOUT_MINUTES=30
MAX_DEVICES_PER_USER=5

# Media Processing
THUMBNAIL_WIDTH=320
THUMBNAIL_FPS=10
MAX_VIDEO_RESOLUTION=1080
PARALLEL_WORKERS=4

# Database (auto-configured by setup)
DB_PASSWORD=<auto-generated>
REDIS_PASSWORD=<auto-generated>
JWT_ACCESS_SECRET=<auto-generated>
JWT_REFRESH_SECRET=<auto-generated>
MASTER_ENCRYPTION_KEY=<auto-generated>
```

### Storage Locations

```
secure-media-library/
‚îú‚îÄ‚îÄ imports/          # Drop new media files here
‚îú‚îÄ‚îÄ assets/           # Processed, encrypted media
‚îÇ   ‚îú‚îÄ‚îÄ images/       # Encrypted WebP images
‚îÇ   ‚îî‚îÄ‚îÄ videos/       # Encrypted HLS video streams
‚îú‚îÄ‚îÄ private/          # SSL certs and encryption keys
‚îú‚îÄ‚îÄ logs/             # Application logs
‚îî‚îÄ‚îÄ temp/             # Temporary processing files
```

## üì± Usage Guide

### Adding Media Files

1. **Local Upload**: Copy files to the `imports/` directory
   ```bash
   cp ~/Pictures/*.jpg imports/
   cp ~/Movies/*.mp4 imports/
   ```

2. **Remote Upload** (via SFTP/SCP):
   ```bash
   scp photo.jpg user@your-server:~/secure-media-library/imports/
   ```

3. Files are automatically:
   - Detected within 5 seconds
   - Processed (converted, encrypted, thumbnailed)
   - Added to your library
   - Removed from imports after processing

### Supported Formats

| Media Type | Supported Formats |
|------------|-------------------|
| **Images** | JPEG, PNG, GIF, WebP, HEIC/HEIF, BMP, TIFF |
| **Videos** | MP4, MOV, AVI, MKV, WebM, FLV, WMV |

### Viewing Your Media

1. **Gallery View**: Browse all media with animated thumbnails
2. **Image Viewer**: Click any image for full-screen viewing
3. **Video Player**: Adaptive streaming with quality selection
4. **Search**: Filter by date, type, or filename
5. **Favorites**: Mark media as favorites for quick access

### Managing Sessions

- View active sessions: Click your profile ‚Üí Sessions
- Remote logout: End sessions on other devices
- Auto-logout: Sessions expire after 30 minutes of inactivity

## üèóÔ∏è Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   VPN Client    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Router OpenVPN  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ   Mac Mini Host  ‚îÇ
                        ‚îÇ   Port 1027      ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Docker Network                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ    Nginx     ‚îÇ   Next.js    ‚îÇ    Python    ‚îÇ   Database    ‚îÇ
‚îÇ  (SSL/Proxy) ‚îÇ  (Frontend)  ‚îÇ (Processor)  ‚îÇ  (PostgreSQL) ‚îÇ
‚îÇ              ‚îÇ              ‚îÇ              ‚îÇ               ‚îÇ
‚îÇ   Port 1027  ‚îÇ   Port 3000  ‚îÇ   Worker     ‚îÇ   Port 5432   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Security Layers

1. **Network Level**: VPN-only access (10.8.0.0/24)
2. **Transport Level**: SSL/TLS encryption
3. **Application Level**: JWT authentication
4. **Storage Level**: AES-128 file encryption
5. **Session Level**: Redis-backed secure sessions

## üîß Advanced Configuration

### Performance Tuning

For large media libraries (1000+ files):

```yaml
# docker-compose.override.yml
services:
  media-processor:
    environment:
      - PARALLEL_WORKERS=8
      - BATCH_SIZE=50
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
```

### Custom SSL Certificate

Replace the self-signed certificate:

```bash
# Copy your certificates
cp /path/to/cert.pem private/server.pem
cp /path/to/key.pem private/server.key

# Restart nginx
docker-compose restart nginx
```

### Backup Strategy

```bash
# Backup script (add to cron)
#!/bin/bash
BACKUP_DIR="/path/to/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Database backup
docker-compose exec -T postgres pg_dump -U postgres media_streaming | \
  gzip > "$BACKUP_DIR/db_backup_$DATE.sql.gz"

# Media files backup (encrypted)
tar czf "$BACKUP_DIR/media_backup_$DATE.tar.gz" assets/

# Configuration backup
tar czf "$BACKUP_DIR/config_backup_$DATE.tar.gz" \
  .env config.yaml private/encryption.key
```

## üêõ Troubleshooting

### Common Issues

#### Cannot Access the Application
```bash
# 1. Check VPN connection
ping 10.8.0.1

# 2. Verify Docker services
docker-compose ps
docker-compose logs nginx

# 3. Test local access
curl -k https://localhost:1027/api/health

# 4. Check firewall
sudo pfctl -s rules | grep 1027
```

#### Media Processing Stuck
```bash
# Check processor logs
docker-compose logs -f media-processor

# Check queue status
docker-compose exec postgres psql -U postgres -d media_streaming \
  -c "SELECT * FROM processing_queue WHERE status != 'completed';"

# Restart processor
docker-compose restart media-processor
```

#### High Memory Usage
```bash
# Check Docker stats
docker stats

# Limit memory usage
docker-compose down
# Edit docker-compose.yml to add memory limits
docker-compose up -d
```

### Debug Mode

Enable detailed logging:
```bash
# .env
LOG_LEVEL=debug
DEBUG=true

# Restart services
docker-compose restart
```

## üîÑ Maintenance

### Daily Tasks
- Monitor disk space: `df -h`
- Check logs for errors: `docker-compose logs --since 24h | grep ERROR`

### Weekly Tasks
- Update Docker images: `docker-compose pull`
- Clean temporary files: `rm -rf temp/*`
- Review access logs for security

### Monthly Tasks
- Rotate encryption keys: `./scripts/rotate-keys.sh`
- Database optimization: `docker-compose exec postgres vacuumdb -U postgres -d media_streaming`
- Security audit: Review access_logs table

## üõ†Ô∏è Development

### Local Development Setup

```bash
# Install dependencies
cd nextjs && npm install
cd ../python && pip install -r requirements.txt

# Run in development mode
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

### API Endpoints

| Endpoint | Method | Description |
|----------|---------|-------------|
| `/api/auth/login` | POST | User authentication |
| `/api/auth/logout` | POST | End session |
| `/api/auth/refresh` | POST | Refresh access token |
| `/api/media/library` | GET | List all media |
| `/api/media/stream/{id}` | GET | Stream media file |
| `/api/media/thumbnail/{id}` | GET | Get thumbnail |
| `/api/sessions` | GET | List active sessions |

### Testing

```bash
# Run Next.js tests
cd nextjs && npm test

# Test media processing
docker-compose exec media-processor python -m pytest

# API integration tests
./scripts/test-api.sh
```

## üìÑ License

Private project - All rights reserved

## ü§ù Support

For issues and questions:
1. Check the [Troubleshooting](#-troubleshooting) section
2. Review logs: `docker-compose logs`
3. Open an issue with:
   - System details (macOS version, Docker version)
   - Error messages
   - Steps to reproduce

---

Built in 2 days by Claude Code with ‚ù§Ô∏è for media enthusiasts who value privacy and security.